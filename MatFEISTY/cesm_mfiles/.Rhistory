ddend_k <- cutree(ddfish, k=7)
dcoef25$Cluster <- ddend_k
acoef25 <- acoef25[,c("LME","Cluster")]
acoef <- merge(acoef,acoef25,by="LME",all=T)
fcoef25 <- fcoef25[,c("LME","Cluster")]
fcoef <- merge(fcoef,fcoef25,by="LME",all=T)
pcoef25 <- pcoef25[,c("LME","Cluster")]
pcoef <- merge(pcoef,pcoef25,by="LME",all=T)
dcoef25 <- dcoef25[,c("LME","Cluster")]
dcoef <- merge(dcoef,dcoef25,by="LME",all=T)
write.table(fcoef,paste0(datar,"LME_FishMIP_cme_F_mlr_coeffs_reduc_ALLdiv2SD_alllags_R2_025_cluster.csv"),sep=",",row.names=F)
write.table(pcoef,paste0(datar,"LME_FishMIP_cme_P_mlr_coeffs_reduc_ALLdiv2SD_alllags_R2_025_cluster.csv"),sep=",",row.names=F)
write.table(dcoef,paste0(datar,"LME_FishMIP_cme_D_mlr_coeffs_reduc_ALLdiv2SD_alllags_R2_025_cluster.csv"),sep=",",row.names=F)
write.table(acoef,paste0(datar,"LME_FishMIP_cme_A_mlr_coeffs_reduc_ALLdiv2SD_alllags_R2_025_cluster.csv"),sep=",",row.names=F)
rm(list=ls())
library(ggplot2)
library(cowplot) #plot_grid
library(gridExtra)
library(ggpubr) #cowplot and gridExtra
library(gplots)
library(reshape2) #melt
library(rpart)
library(tree)
library(pvclust)
library(mclust)
library(dendextend)
source(file = "/Users/cpetrik/Dropbox/UCSC/CVC-LCM/CVC_data/outmigration_model/HighstatLibV6.r")
setwd("/Users/cpetrik/Dropbox/Princeton/FEISTY/CODE/fish-offline/MatFEISTY/cesm_mfiles/")
figp <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Figs/PNG/CESM_MAPP/FOSI/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/corrs/"
### ------------------------------------------------------------
# load data
datap <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/FOSI/"
datar <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/regressions/"
#datar <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Data/FOSI/"
dataf <- "/Volumes/petrik-lab/Feisty/Fish-MIP/Phase3/fishing/"
fcoef <- read.csv(paste0(datar,"LMEs_mlr_cme_drivers_ALLdiv2SD_alllags3_noint_reduc_F.csv"),sep=",",header = T,stringsAsFactors = F)
pcoef <- read.csv(paste0(datar,"LMEs_mlr_cme_drivers_ALLdiv2SD_alllags3_noint_reduc_P.csv"),sep=",",header = T,stringsAsFactors = F)
dcoef <- read.csv(paste0(datar,"LMEs_mlr_cme_drivers_ALLdiv2SD_alllags3_noint_reduc_D.csv"),sep=",",header = T,stringsAsFactors = F)
acoef <- read.csv(paste0(datar,"LMEs_mlr_cme_drivers_ALLdiv2SD_alllags3_noint_reduc_A.csv"),sep=",",header = T,stringsAsFactors = F)
# R2>0.5
fcoef25 <- subset(fcoef, R2 >= 0.25)
pcoef25 <- subset(pcoef, R2 >= 0.25)
dcoef25 <- subset(dcoef, R2 >= 0.25)
acoef25 <- subset(acoef, R2 >= 0.25)
### Use heatmap & clustering tree to find patterns
# Cluster LMEs
Acoef <- acoef25[,1:4]
rownames(Acoef) <- acoef25$LME
# anm <- c("Det1","Det2","TB1","TB2","TP1","TP2","ZmLoss1","ZmLoss2")
# Acoef <- Acoef[,anm]
Acoef[is.na(Acoef)] <- 0
ad_fish <- dist(Acoef) # method="man" # is a bit better
ahc_fish <- hclust(ad_fish, method = "ward.D")
adfish <- as.dendrogram(ahc_fish)
# Color the branches based on the clusters:
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=7)
# reduce the size of the labels:
adfish <- set(adfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-15,-5,-2,-1.1, # for low
seq(-1,1,length=21), # for blue
1.1,2,5,15) # for high
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
png(paste0(figp,"reduc_heatmap_LME_A_cme_mlr_coeffs_R2_025_ALLdiv2SD_alllags3_v2.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
## All
adend_k <- cutree(adfish, k=8)
acoef25$Cluster <- adend_k
acoef25 <- acoef25[,c("LME","Cluster")]
acoef <- merge(acoef,acoef25,by="LME",all=T)
write.table(acoef,paste0(datar,"LME_FishMIP_cme_A_mlr_coeffs_reduc_ALLdiv2SD_alllags_R2_025_cluster.csv"),sep=",",row.names=F)
rm(list=ls())
library(ggplot2)
library(cowplot) #plot_grid
library(gridExtra)
library(ggpubr) #cowplot and gridExtra
library(gplots)
library(reshape2) #melt
library(rpart)
library(tree)
library(pvclust)
library(mclust)
library(dendextend)
source(file = "/Users/cpetrik/Dropbox/UCSC/CVC-LCM/CVC_data/outmigration_model/HighstatLibV6.r")
setwd("/Users/cpetrik/Dropbox/Princeton/FEISTY/CODE/fish-offline/MatFEISTY/cesm_mfiles/")
figp <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Figs/PNG/CESM_MAPP/FOSI/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/corrs/"
###
datap <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/FOSI/"
datar <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/regressions/"
#datar <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Data/FOSI/"
dataf <- "/Volumes/petrik-lab/Feisty/Fish-MIP/Phase3/fishing/"
fcoef <- read.csv(paste0(datar,"LMEs_mlr_cpue_drivers_ALLdiv2SD_alllags3_noint_reduc_F.csv"),sep=",",header = T,stringsAsFactors = F)
pcoef <- read.csv(paste0(datar,"LMEs_mlr_cpue_drivers_ALLdiv2SD_alllags3_noint_reduc_P.csv"),sep=",",header = T,stringsAsFactors = F)
dcoef <- read.csv(paste0(datar,"LMEs_mlr_cpue_drivers_ALLdiv2SD_alllags3_noint_reduc_D.csv"),sep=",",header = T,stringsAsFactors = F)
acoef <- read.csv(paste0(datar,"LMEs_mlr_cpue_drivers_ALLdiv2SD_alllags3_noint_reduc_A.csv"),sep=",",header = T,stringsAsFactors = F)
# R2>0.5
fcoef25 <- subset(fcoef, R2 >= 0.25)
pcoef25 <- subset(pcoef, R2 >= 0.25)
dcoef25 <- subset(dcoef, R2 >= 0.25)
acoef25 <- subset(acoef, R2 >= 0.25)
### Use heatmap & clustering tree to find patterns
# Cluster LMEs
Acoef <- acoef25[,1:4]
rownames(Acoef) <- acoef25$LME
Acoef[is.na(Acoef)] <- 0
ad_fish <- dist(Acoef) # method="man" # is a bit better
ahc_fish <- hclust(ad_fish, method = "ward.D")
adfish <- as.dendrogram(ahc_fish)
# Color the branches based on the clusters:
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=7)
# reduce the size of the labels:
adfish <- set(adfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-15,-5,-2,-1.1, # for low
seq(-1,1,length=21), # for blue
1.1,2,5,15) # for high
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
rm(list=ls())
library(ggplot2)
library(cowplot) #plot_grid
library(gridExtra)
library(ggpubr) #cowplot and gridExtra
library(gplots)
library(reshape2) #melt
library(rpart)
library(tree)
library(pvclust)
library(mclust)
library(dendextend)
source(file = "/Users/cpetrik/Dropbox/UCSC/CVC-LCM/CVC_data/outmigration_model/HighstatLibV6.r")
setwd("/Users/cpetrik/Dropbox/Princeton/FEISTY/CODE/fish-offline/MatFEISTY/cesm_mfiles/")
figp <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Figs/PNG/CESM_MAPP/FOSI/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/corrs/"
### ------------------------------------------------------------
# load data
datap <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/FOSI/"
datar <- "/Volumes/petrik-lab/Feisty/NC/CESM_MAPP/Dc_Lam700_enc70-b200_m400-b175-k086_c20-b250_D075_A050_sMZ090_mMZ045_nmort1_BE08_CC80_RE00100/regressions/"
#datar <- "/Users/cpetrik/Petrik Lab Group Dropbox/Colleen Petrik/Princeton/FEISTY/CODE/Data/FOSI/"
fcoef <- read.csv(paste0(datar,"LMEs_mlr_biom_drivers_ALLdiv2SD_alllags3_noint_reduc_F.csv"),sep=",",header = T,stringsAsFactors = F)
pcoef <- read.csv(paste0(datar,"LMEs_mlr_biom_drivers_ALLdiv2SD_alllags3_noint_reduc_P.csv"),sep=",",header = T,stringsAsFactors = F)
dcoef <- read.csv(paste0(datar,"LMEs_mlr_biom_drivers_ALLdiv2SD_alllags3_noint_reduc_D.csv"),sep=",",header = T,stringsAsFactors = F)
acoef <- read.csv(paste0(datar,"LMEs_mlr_biom_drivers_ALLdiv2SD_alllags3_noint_reduc_A.csv"),sep=",",header = T,stringsAsFactors = F)
bcoef <- read.csv(paste0(datar,"LMEs_mlr_biom_drivers_ALLdiv2SD_alllags3_noint_reduc_B.csv"),sep=",",header = T,stringsAsFactors = F)
Acoef <- acoef[,1:4]
rownames(Acoef) <- acoef$LME
Acoef[is.na(Acoef)] <- 0
ad_fish <- dist(Acoef) # method="man" # is a bit better
ahc_fish <- hclust(ad_fish, method = "ward.D")
adfish <- as.dendrogram(ahc_fish)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=6)
# reduce the size of the labels:
adfish <- set(adfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-15,-5,-2,-1.1, # for low
seq(-1,1,length=21), # for blue
1.1,2,5,15) # for high
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=7)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=8)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=9)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
png(paste0(figp,"reduc_heatmap_LME_A_mlr_coeffs_ALLdiv2SD_alllags3_v2.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
fcoef50 <- subset(fcoef, R2 >= 0.5)
pcoef50 <- subset(pcoef, R2 >= 0.5)
dcoef50 <- subset(dcoef, R2 >= 0.5)
acoef50 <- subset(acoef, R2 >= 0.5)
bcoef50 <- subset(bcoef, R2 >= 0.5)
### Use heatmap & clustering tree to find patterns
# Cluster LMEs
Acoef <- acoef50[,1:4]
rownames(Acoef) <- acoef50$LME
Acoef[is.na(Acoef)] <- 0
ad_fish <- dist(Acoef) # method="man" # is a bit better
ahc_fish <- hclust(ad_fish, method = "ward.D")
adfish <- as.dendrogram(ahc_fish)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=7)
adend_6 <- cutree(adfish, k=7)
# reduce the size of the labels:
adfish <- set(adfish, "labels_cex", 0.8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
# Color the branches based on the clusters:
adfish <- color_branches(adfish, k=8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
adfish <- color_branches(adfish, k=9)
adend_6 <- cutree(adfish, k=9)
# reduce the size of the labels:
adfish <- set(adfish, "labels_cex", 0.8)
dev.off()
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
png(paste0(figp,"reduc_heatmap_LME_A_mlr_coeffs_R2_05_ALLdiv2SD_alllags3_v2.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Acoef),
main = "All fish",
dendrogram = "row",
Rowv = adfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(6,6),
srtCol = 45, #45 deg angle labels
offsetCol=-0.6,
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
keysize = 1.5,
density.info = "none",
col = some_col_func #, breaks=col_breaks
)
dev.off()
## All
adend_k <- cutree(adfish, k=9)
acoef50$Cluster <- adend_k
### Save 0.5 (not 0.7)
acoef50 <- acoef50[,c("LME","Cluster")]
acoef <- merge(acoef,acoef50,by="LME",all=T)
write.table(acoef,paste0(datar,"LME_A_mlr_coeffs_reduc_ALLdiv2SD_alllags3_R2_05_cluster.csv"),sep=",",row.names=F)
