bcombo <- dredge(bmod)
## Put coefficients & p-val of best model in arrays for saving
xx <- (bcombo)[1]
bcoef[i, match(names(xx), colnames(bcoef))] = xx
y <- summary(get.models(bcombo, 1)[[1]])
yy <- (y$coefficients[,4])
bpval[i, match(names(yy), colnames(bpval))] = yy
} # LMEs
write.table(fcoef,paste0(datar,"LME_F_mlr_coeffs_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(pcoef,paste0(datar,"LME_P_mlr_coeffs_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(dcoef,paste0(datar,"LME_D_mlr_coeffs_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(acoef,paste0(datar,"LME_A_mlr_coeffs_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(bcoef,paste0(datar,"LME_B_mlr_coeffs_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(fpval,paste0(datar,"LME_F_mlr_pvals_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(ppval,paste0(datar,"LME_P_mlr_pvals_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(dpval,paste0(datar,"LME_D_mlr_pvals_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(apval,paste0(datar,"LME_A_mlr_pvals_ALLdiv2SD.csv"),sep=",",row.names=F)
write.table(bpval,paste0(datar,"LME_B_mlr_pvals_ALLdiv2SD.csv"),sep=",",row.names=F)
### Would heatmap or something help find patterns?
library(ggplot2)
library(cowplot) #plot_grid
library(gridExtra)
library(ggpubr) #cowplot and gridExtra
library(gplots)
Acoef <- acoef[,2:9]
Acoef$LME <- acoef$LME
test <- melt(Acoef)
names(test) <- c("LME","driver","coef")
a1 <- ggplot(data = test, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") +
scale_fill_distiller(palette = "RdBu", name="coef") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("All fish") +
geom_text(aes(Lag, Type, label = sym), color = "black", size = 3)
#scale_fill_distiller(palette = "RdBu", limit = c(-1.05,1.05),
#                     breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
#                     labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="Det\ncorr") +
# Cluster LMEs
library(rpart)
library(tree)
library(pvclust)
library(mclust)
library(dendextend)
vmat <- as.matrix(vec[2:39,c(2:6,8)])
tvec <- Acoef[,1:8]
rownames(tvec) <- Acoef[,9]
tvec[is.na(tvec)] <- 0
d_fish <- dist(tvec) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# We hang the dendrogram a bit:
#dfish <- hang.dendrogram(dfish,hang_height=0.1)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
# And plot:
pdf(paste0(figp,"Cluster_LME_A_mlr_coeffs_ALLdiv2SD.pdf"))
par(mfrow = c(1,1))
par(mar = c(3,3,3,7))
plot(dfish,
main = "hclust complete",
horiz =  TRUE,  nodePar = list(cex = .007))
dev.off()
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-15,-5,-2,-1.1, # for low
seq(-1,1,length=21), # for blue
1.1,2,5,15) # for high
test <- colorspace::diverge_hcl(28)
hv <- heatmap.2(as.matrix(tvec),
trace="none",
col = some_col_func)
names(hv)
#color mapping
crang <- hv$colorTable
crang$color <- as.character(crang$color)
# Extract the range associated with white
hv$colorTable[hv$colorTable[,"color"]=="#E2E2E2",]
png(paste0(figp,"hclust_wardD_heatmap_LME_A_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(tvec),
main = "All fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
#add.expr=text(x=0.2, y=-0.1, srt=45, xpd=NA, adj=0, labels="Mag"),
col = some_col_func #, breaks=col_breaks
)
dev.off()
## Forage
Fcoef <- fcoef[,2:9]
rownames(Fcoef) <- fcoef$LME
Fcoef[is.na(Fcoef)] <- 0
d_fish <- dist(Fcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_F_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Fcoef),
main = "Forage fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Lg Pel
Pcoef <- pcoef[,2:9]
rownames(Pcoef) <- pcoef$LME
Pcoef[is.na(Pcoef)] <- 0
d_fish <- dist(Pcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_P_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Pcoef),
main = "Large Pelagics",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Dem
Dcoef <- dcoef[,2:9]
rownames(Dcoef) <- dcoef$LME
Dcoef[is.na(Dcoef)] <- 0
d_fish <- dist(Dcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_D_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Dcoef),
main = "Demersals",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Bent
Bcoef <- bcoef[,2:9]
rownames(Bcoef) <- bcoef$LME
Bcoef[is.na(Bcoef)] <- 0
d_fish <- dist(Bcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_B_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Bcoef),
main = "Benthos",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
dev.off()
tvec <- Acoef[,1:8]
rownames(tvec) <- Acoef[,9]
tvec[is.na(tvec)] <- 0
d_fish <- dist(tvec) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# We hang the dendrogram a bit:
#dfish <- hang.dendrogram(dfish,hang_height=0.1)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
png(paste0(figp,"hclust_wardD_heatmap_LME_A_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(tvec),
main = "All fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
#add.expr=text(x=0.2, y=-0.1, srt=45, xpd=NA, adj=0, labels="Mag"),
col = some_col_func #, breaks=col_breaks
)
dev.off()
## Forage
Fcoef <- fcoef[,2:9]
rownames(Fcoef) <- fcoef$LME
Fcoef[is.na(Fcoef)] <- 0
d_fish <- dist(Fcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_F_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Fcoef),
main = "Forage fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Lg Pel
Pcoef <- pcoef[,2:9]
rownames(Pcoef) <- pcoef$LME
Pcoef[is.na(Pcoef)] <- 0
d_fish <- dist(Pcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_P_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Pcoef),
main = "Large Pelagics",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Dem
Dcoef <- dcoef[,2:9]
rownames(Dcoef) <- dcoef$LME
Dcoef[is.na(Dcoef)] <- 0
d_fish <- dist(Dcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_D_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Dcoef),
main = "Demersals",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Bent
Bcoef <- bcoef[,2:9]
rownames(Bcoef) <- bcoef$LME
Bcoef[is.na(Bcoef)] <- 0
d_fish <- dist(Bcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_B_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Bcoef),
main = "Benthos",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Forage
Fcoef <- fcoef[,2:9]
rownames(Fcoef) <- fcoef$LME
Fcoef[is.na(Fcoef)] <- 0
d_fish <- dist(Fcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_F_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Fcoef),
main = "Forage fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Lg Pel
Pcoef <- pcoef[,2:9]
rownames(Pcoef) <- pcoef$LME
Pcoef[is.na(Pcoef)] <- 0
d_fish <- dist(Pcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_P_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Pcoef),
main = "Large Pelagics",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Dem
Dcoef <- dcoef[,2:9]
rownames(Dcoef) <- dcoef$LME
Dcoef[is.na(Dcoef)] <- 0
d_fish <- dist(Dcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_D_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Dcoef),
main = "Demersals",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Bent
Bcoef <- bcoef[,2:9]
rownames(Bcoef) <- bcoef$LME
Bcoef[is.na(Bcoef)] <- 0
d_fish <- dist(Bcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=8)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_LME_B_mlr_coeffs_ALLdiv2SD.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 6.5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Bcoef),
main = "Benthos",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
