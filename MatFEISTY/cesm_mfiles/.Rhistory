afish <- data.frame(matrix(ncol = 6, nrow = yen))
names(afish) <- c('Fish','TP','TB','Det','Zmeso','ZmLoss')
afish$TP[(yst-Alag$TP[i]):(yen-Alag$TP[i])] <- drive$TP
afish$TB[(yst-Alag$TB[i]):(yen-Alag$TB[i])] <- drive$TB
afish$Det[(yst-Alag$Det[i]):(yen-Alag$Det[i])] <- drive$Det
afish$Zmeso[(yst-Alag$Zmeso[i]):(yen-Alag$Zmeso[i])] <- drive$Zmeso
afish$ZmLoss[(yst-Alag$ZmLoss[i]):(yen-Alag$ZmLoss[i])] <- drive$ZmLoss
afish$Fish[(yst):(yen)] <- A[,cn]
afish <- na.omit(afish)
amod <- lm(Fish ~ TP + TB + Det + Zmeso + ZmLoss + TP*Zmeso + TP*ZmLoss + TB*Det, data=afish)
acombo <- dredge(amod)
## Put coefficients & p-val of best model in arrays for saving
xx <- (acombo)[1]
acoef[i, match(names(xx), colnames(acoef))] = xx
y <- summary(get.models(acombo, 1)[[1]])
yy <- (y$coefficients[,4])
apval[i, match(names(yy), colnames(apval))] = yy
### B ----------------------------------------------------------------
maxb <- max(Blag[i,])
yst <- 1+maxb
yen <- 68+maxb
bent <- data.frame(matrix(ncol = 6, nrow = yen))
names(bent) <- c('Bent','TP','TB','Det','Zmeso','ZmLoss')
bent$TP[(yst-Blag$TP[i]):(yen-Blag$TP[i])] <- drive$TP
bent$TB[(yst-Blag$TB[i]):(yen-Blag$TB[i])] <- drive$TB
bent$Det[(yst-Blag$Det[i]):(yen-Blag$Det[i])] <- drive$Det
bent$Zmeso[(yst-Blag$Zmeso[i]):(yen-Blag$Zmeso[i])] <- drive$Zmeso
bent$ZmLoss[(yst-Blag$ZmLoss[i]):(yen-Blag$ZmLoss[i])] <- drive$ZmLoss
bent$Bent[(yst):(yen)] <- B[,cn]
bent <- na.omit(bent)
bmod <- lm(Bent ~ TP + TB + Det + Zmeso + ZmLoss + TP*Zmeso + TP*ZmLoss + TB*Det, data=bent)
bcombo <- dredge(bmod)
## Put coefficients & p-val of best model in arrays for saving
xx <- (bcombo)[1]
bcoef[i, match(names(xx), colnames(bcoef))] = xx
y <- summary(get.models(bcombo, 1)[[1]])
yy <- (y$coefficients[,4])
bpval[i, match(names(yy), colnames(bpval))] = yy
} # LMEs
write.table(fcoef,paste0(datar,"USlme_F_mlr_coeffs_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(pcoef,paste0(datar,"USlme_P_mlr_coeffs_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(dcoef,paste0(datar,"USlme_D_mlr_coeffs_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(acoef,paste0(datar,"USlme_A_mlr_coeffs_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(bcoef,paste0(datar,"USlme_B_mlr_coeffs_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(fpval,paste0(datar,"USlme_F_mlr_pvals_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(ppval,paste0(datar,"USlme_P_mlr_pvals_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(dpval,paste0(datar,"USlme_D_mlr_pvals_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(apval,paste0(datar,"USlme_A_mlr_pvals_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
write.table(bpval,paste0(datar,"USlme_B_mlr_pvals_ALLdiv2SD_lag3.csv"),sep=",",row.names=F)
### Would heatmap or something help find patterns?
library(ggplot2)
library(cowplot) #plot_grid
library(gridExtra)
library(ggpubr) #cowplot and gridExtra
library(gplots)
library(reshape2)
Fcoef <- fcoef[,2:9]
Fcoef$LME <- fcoef$LME
mFcoef <- melt(Fcoef,id="LME")
names(mFcoef) <- c("LME","driver","coef")
Fpval <- fpval[,2:9]
Fpval$LME <- fpval$LME
mFpval <- melt(Fpval,id="LME")
names(mFpval) <- c("LME","driver","pval")
mFpval$sym <- mFpval$pval
mFpval$sym[mFpval$pval <= 0.05] <- "*"
mFpval$sym[mFpval$pval > 0.05] <- NA
mFcoef$sym <- mFpval$sym
Pcoef <- pcoef[,2:9]
Pcoef$LME <- pcoef$LME
mPcoef <- melt(Pcoef,id="LME")
names(mPcoef) <- c("LME","driver","coef")
Ppval <- ppval[,2:9]
Ppval$LME <- ppval$LME
mPpval <- melt(Ppval,id="LME")
names(mPpval) <- c("LME","driver","pval")
mPpval$sym <- mPpval$pval
mPpval$sym[mPpval$pval <= 0.05] <- "*"
mPpval$sym[mPpval$pval > 0.05] <- NA
mPcoef$sym <- mPpval$sym
Dcoef <- dcoef[,2:9]
Dcoef$LME <- dcoef$LME
mDcoef <- melt(Dcoef,id="LME")
names(mDcoef) <- c("LME","driver","coef")
Dpval <- dpval[,2:9]
Dpval$LME <- dpval$LME
mDpval <- melt(Dpval,id="LME")
names(mDpval) <- c("LME","driver","pval")
mDpval$sym <- mDpval$pval
mDpval$sym[mDpval$pval <= 0.05] <- "*"
mDpval$sym[mDpval$pval > 0.05] <- NA
mDcoef$sym <- mDpval$sym
Acoef <- acoef[,2:9]
Acoef$LME <- acoef$LME
mAcoef <- melt(Acoef,id="LME")
names(mAcoef) <- c("LME","driver","coef")
Apval <- apval[,2:9]
Apval$LME <- apval$LME
mApval <- melt(Apval,id="LME")
names(mApval) <- c("LME","driver","pval")
mApval$sym <- mApval$pval
mApval$sym[mApval$pval <= 0.05] <- "*"
mApval$sym[mApval$pval > 0.05] <- NA
mAcoef$sym <- mApval$sym
Bcoef <- bcoef[,2:9]
Bcoef$LME <- bcoef$LME
mBcoef <- melt(Bcoef,id="LME")
names(mBcoef) <- c("LME","driver","coef")
Bpval <- bpval[,2:9]
Bpval$LME <- bpval$LME
mBpval <- melt(Bpval,id="LME")
names(mBpval) <- c("LME","driver","pval")
mBpval$sym <- mBpval$pval
mBpval$sym[mBpval$pval <= 0.05] <- "*"
mBpval$sym[mBpval$pval > 0.05] <- NA
mBcoef$sym <- mBpval$sym
f1 <- ggplot(data = mFcoef, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") +
scale_fill_distiller(palette = "RdBu", limit = c(-2.6,2.6),
breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="coeff") +
theme_minimal() + labs(x="") + labs(y="LME") +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("Forage fish") +
geom_text(aes(driver, LME, label = sym), color = "black", size = 5)
p1 <- ggplot(data = mPcoef, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") + labs(x="") + labs(y="") +
scale_fill_distiller(palette = "RdBu", limit = c(-2.6,2.6),
breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="coeff") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("Large pelagics") +
geom_text(aes(driver, LME, label = sym), color = "black", size = 5)
d1 <- ggplot(data = mDcoef, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") + labs(x="Driver") + labs(y="LME") +
scale_fill_distiller(palette = "RdBu", limit = c(-2.6,2.6),
breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="coeff") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("Demersals") +
geom_text(aes(driver, LME, label = sym), color = "black", size = 5)
a1 <- ggplot(data = mAcoef, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") + labs(x="Driver") + labs(y="") +
scale_fill_distiller(palette = "RdBu", limit = c(-2.6,2.6),
breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="coeff") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("All fish") +
geom_text(aes(driver, LME, label = sym), color = "black", size = 5)
b1 <- ggplot(data = mBcoef, aes(y=LME, x=driver, fill=coef)) +
geom_tile(color = "white") + labs(x="Driver") + labs(y="") +
scale_fill_distiller(palette = "RdBu", limit = c(-2.6,2.6),
breaks=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5),
labels=c(-1.5,-1.0,-0.5,0,0.5,1.0,1.5), name="coeff") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 8, hjust = 1)) +
coord_fixed() + ggtitle("Benthos") +
geom_text(aes(driver, LME, label = sym), color = "black", size = 5)
png(paste0(figp,'Heatmaps_USLME_mlr_coeffs_ALLdiv2SD_lag3.png'),
width = 9*300,        # 5 x 300 pixels
height = 6*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
ggarrange(f1,p1,a1,
d1,b1,
nrow = 2, ncol = 3,labels = "auto",
common.legend = TRUE, legend = "right")
dev.off()
# Cluster LMEs
library(rpart)
library(tree)
library(pvclust)
library(mclust)
library(dendextend)
tvec <- Acoef[,1:8]
rownames(tvec) <- Acoef[,9]
tvec[is.na(tvec)] <- 0
d_fish <- dist(tvec) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-5,-2,-1,-0.5, # for low
seq(-0.4,0.4,length=21), # for blue
0.5,1,2,5) # for high
# test <- colorspace::diverge_hcl(28)
# hv <- heatmap.2(as.matrix(tvec),
#                 trace="none",
#                 col = some_col_func)
png(paste0(figp,"hclust_wardD_heatmap_USLME_A_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(tvec),
main = "All fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
#add.expr=text(x=0.2, y=-0.1, srt=45, xpd=NA, adj=0, labels="Mag"),
col = some_col_func #, breaks=col_breaks
)
dev.off()
## Forage
Fcoef <- fcoef[,2:9]
rownames(Fcoef) <- fcoef$LME
Fcoef[is.na(Fcoef)] <- 0
d_fish <- dist(Fcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_F_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Fcoef),
main = "Forage fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Lg Pel
Pcoef <- pcoef[,2:9]
rownames(Pcoef) <- pcoef$LME
Pcoef[is.na(Pcoef)] <- 0
d_fish <- dist(Pcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_P_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Pcoef),
main = "Large Pelagics",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Dem
Dcoef <- dcoef[,2:9]
rownames(Dcoef) <- dcoef$LME
Dcoef[is.na(Dcoef)] <- 0
d_fish <- dist(Dcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_D_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Dcoef),
main = "Demersals",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Bent
Bcoef <- bcoef[,2:9]
rownames(Bcoef) <- bcoef$LME
Bcoef[is.na(Bcoef)] <- 0
d_fish <- dist(Bcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=2)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_B_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Bcoef),
main = "Benthos",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
tvec <- Acoef[,1:8]
rownames(tvec) <- Acoef[,9]
tvec[is.na(tvec)] <- 0
d_fish <- dist(tvec) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=3)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
some_col_func <- colorspace::diverge_hcl(25)
col_breaks = c(-5,-2,-1,-0.5, # for low
seq(-0.4,0.4,length=21), # for blue
0.5,1,2,5) # for high
# test <- colorspace::diverge_hcl(28)
# hv <- heatmap.2(as.matrix(tvec),
#                 trace="none",
#                 col = some_col_func)
png(paste0(figp,"hclust_wardD_heatmap_USLME_A_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(tvec),
main = "All fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
#RowSideColors = ccol$col,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
#add.expr=text(x=0.2, y=-0.1, srt=45, xpd=NA, adj=0, labels="Mag"),
col = some_col_func #, breaks=col_breaks
)
dev.off()
## Forage
Fcoef <- fcoef[,2:9]
rownames(Fcoef) <- fcoef$LME
Fcoef[is.na(Fcoef)] <- 0
d_fish <- dist(Fcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=3)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_F_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Fcoef),
main = "Forage fish",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Lg Pel
Pcoef <- pcoef[,2:9]
rownames(Pcoef) <- pcoef$LME
Pcoef[is.na(Pcoef)] <- 0
d_fish <- dist(Pcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=3)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_P_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Pcoef),
main = "Large Pelagics",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Dem
Dcoef <- dcoef[,2:9]
rownames(Dcoef) <- dcoef$LME
Dcoef[is.na(Dcoef)] <- 0
d_fish <- dist(Dcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=3)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_D_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Dcoef),
main = "Demersals",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
## Bent
Bcoef <- bcoef[,2:9]
rownames(Bcoef) <- bcoef$LME
Bcoef[is.na(Bcoef)] <- 0
d_fish <- dist(Bcoef) # method="man" # is a bit better
hc_fish <- hclust(d_fish, method = "ward.D")
dfish <- as.dendrogram(hc_fish)
# Color the branches based on the clusters:
dfish <- color_branches(dfish, k=3)
# reduce the size of the labels:
dfish <- set(dfish, "labels_cex", 0.8)
png(paste0(figp,"hclust_wardD_heatmap_USLME_B_mlr_coeffs_ALLdiv2SD_lag3.png"),    # create PNG for the heat map
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)
gplots::heatmap.2(as.matrix(Bcoef),
main = "Benthos",
srtCol = 45,
dendrogram = "row",
Rowv = dfish,
Colv = "NA", # this to make sure the columns are not ordered
trace="none",
margins =c(3,6),
key.xlab = "Coefficient",
denscol = "grey",
key.title=NA, # no title
density.info = "none",
offsetCol=-0.6,
col = some_col_func)
dev.off()
